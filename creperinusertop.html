<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/osql.js"></script>

    <script>
        osql.requireLogin();

        $().ready(function () {
            init();
        });

        function init() {
            var username = sessionStorage.getItem('username');
            document.getElementById('welcome').innerHTML = 'ようこそ' + username + 'さん';
            document.getElementById('rank').innerHTML = username + 'さんのランクは' + rank + 'です';
        }


        var rank = localStorage.getItem('rank');      //creperinregisterにrank1をsessionStorageに保存されている。それの呼び出し。



        // function a() {//ボタン押したらランクを1あげる
        //     rank = parseInt(rank) + 1;
        //     console.log(rank);
        //     localStorage.rank = rank;
        // }
        // function b() {//ボタン押したらランク0にする
        //     rank = parseInt(rank) * 0 + 1;
        //     localStorage.rank = rank;
        //     console.log(rank);
        // }


        var username = sessionStorage.getItem('username');


        function tweet() {

            if (document.getElementById('content').value == "") {
                document.getElementById('chat').innerHTML = '何か書いてください';
            }
            else {
                $(document).ready(function () {
                    execSelect();
                });
                async function execSelect() {
                    var content = document.getElementById('content').value;
                    var sql = `insert into Chat (username,tweet,time) values( "${username}","${content}",now());`;
                    var objects = osql.connect(sql);
                    console.log(objects);

                    var sql = `SELECT * FROM Chat order by time desc limit 10; `;
                    var objects = await osql.connect(sql);
                    console.log(objects);
                    var html = '';
                    html = html + '<table border="1">';
                    html = html + '<tr>';
                    html = html + '<th>' + 'ユーザー名' + '</th>';
                    html = html + '<th>' + 'ツイート' + '</th>';
                    html = html + '<th>' + '時間' + '</th>';
                    html = html + '</tr>';
                    for (var i = 0; i < objects.length; i++) {
                        html = html + '<tr>';
                        var object = objects[i];
                        html = html + '<td>' + object.username + '</td>';
                        html = html + '<td>' + object.tweet + '</td>';
                        html = html + '<td>' + object.time + '</td>';
                        html = html + '</tr>';
                    }
                    html = html + '</table>';
                    document.getElementById('chat').innerHTML = html;


                }
            }
        }


        window.onload = async function () {     //トップページ読み込み時処理
            var sql = `SELECT * FROM Chat order by time desc limit 10; `;
            var objects = await osql.connect(sql);
            console.log(objects);
            var html = '';
            html = html + '<table border="1">';
            html = html + '<tr>';
            html = html + '<th>' + 'ユーザー名' + '</th>';
            html = html + '<th>' + 'ツイート' + '</th>';
            html = html + '<th>' + '時間' + '</th>';
            html = html + '</tr>';
            for (var i = 0; i < objects.length; i++) {
                html = html + '<tr>';
                var object = objects[i];
                html = html + '<td>' + object.username + '</td>';
                html = html + '<td>' + object.tweet + '</td>';
                html = html + '<td>' + object.time + '</td>';
                html = html + '</tr>';
            }
            html = html + '</table>';
            document.getElementById('chat').innerHTML = html;




            if (rank >= 21) {           //バッジの処理
                document.getElementById('btn1').click();        //上のif条件達成時に下に書いたボタンを押す
            }
        }



        document.addEventListener("DOMContentLoaded", function () {     //ボタンを押したら色変える
            document.getElementById('btn1').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
        })



    </script>

</head>

<h1>トップページ</h1>
<p id="welcome"></p>
<a href="creperintest.html">クレペリン検査はこちら</a>
<br>
<div class="left" style="float: left;">
    <h2>ランク</h2>
    <p id="rank"></p>
    <h2>バッジ</h2>
    <!-- <p id="badge"></p> -->
    <button id="btn1" style="width: 90px; height: 90px;">ゲームを10回した</button>
    <button onclick="button2()" style="width: 90px; height: 90px;">ゲームを50回した</button>
    <button onclick="button3()" style="width: 90px; height: 90px;">ゲームを100回した</button>
    <button onclick="button4()" style="width: 90px; height: 90px;">ゲームを1時間した</button>
    <br>
    <button onclick="button5()" style="width: 90px; height: 90px;">ゲームを10時間した</button>
    <button onclick="button6()" style="width: 90px; height: 90px;">ゲームを20時間した</button>
    <button onclick="button7()" style="width: 90px; height: 90px;">ゲームを50時間した</button>
    <button onclick="button8()" style="width: 90px; height: 90px;">スコア500突破</button>
    <br>
    <button onclick="button9()" style="width: 90px; height: 90px;">スコア550突破</button>
    <button onclick="button10()" style="width: 90px; height: 90px;">スコア600突破</button>
    <button onclick="button11()" style="width: 90px; height: 90px;">ランク10突破</button>
    <button onclick="button12()" style="width: 90px; height: 90px;">ランク30突破</button>
    <br>
    <button onclick="button13()" style="width: 90px; height: 90px;">ランク50突破</button>
    <button onclick="button14()" style="width: 90px; height: 90px;">正解率90%超えた</button>
    <button onclick="button15()" style="width: 90px; height: 90px;">正解率95%超えた</button>
    <button onclick="button16()" style="width: 90px; height: 90px;">正解率100%達成</button>

</div>
<div class="right" style="float: right; padding-right: 100px; padding-left: 100px;">
    <h2>チャット</h2>
    <input type="text" id="content">
    <button onclick="tweet()">つぶやく</button>
    <p id="chat"></p>
</div>

<!-- <button onclick="a()">a</button>
<button onclick="b()">b</button> -->

</body>

</html>