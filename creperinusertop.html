<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/osql.js"></script>

    <script>
        osql.requireLogin();

        $().ready(function () {
            init();
        });

        function init() {
            var username = sessionStorage.getItem('username');
            document.getElementById('welcome').innerHTML = 'ようこそ' + username + 'さん';
            document.getElementById('rank').innerHTML = username + 'さんのランクは' + rank + 'です';
        }


        var rank = localStorage.getItem('rank');      //creperinregisterにrank1をsessionStorageに保存されている。それの呼び出し。



        // function a() {//ボタン押したらランクを1あげる
        //     rank = parseInt(rank) + 1;
        //     console.log(rank);
        //     localStorage.rank = rank;
        // }
        // function b() {//ボタン押したらランク0にする
        //     rank = parseInt(rank) * 0 + 1;
        //     localStorage.rank = rank;
        //     console.log(rank);
        // }


        var username = sessionStorage.getItem('username');


        function tweet() {

            if (document.getElementById('content').value == "") {
                document.getElementById('chat').innerHTML = '何か書いてください';
            }
            else {
                $(document).ready(function () {
                    execSelect();
                });
                async function execSelect() {
                    var content = document.getElementById('content').value;
                    var sql = `insert into Chat (username,tweet,time) values( "${username}","${content}",now());`;
                    var objects = osql.connect(sql);
                    console.log(objects);

                    var sql = `SELECT * FROM Chat order by time desc limit 10; `;
                    var objects = await osql.connect(sql);
                    console.log(objects);
                    var html = '';
                    html = html + '<table border="1">';
                    html = html + '<tr>';
                    html = html + '<th>' + 'ユーザー名' + '</th>';
                    html = html + '<th>' + 'ツイート' + '</th>';
                    html = html + '<th>' + '時間' + '</th>';
                    html = html + '</tr>';
                    for (var i = 0; i < objects.length; i++) {
                        html = html + '<tr>';
                        var object = objects[i];
                        html = html + '<td>' + object.username + '</td>';
                        html = html + '<td>' + object.tweet + '</td>';
                        html = html + '<td>' + object.time + '</td>';
                        html = html + '</tr>';
                    }
                    html = html + '</table>';
                    document.getElementById('chat').innerHTML = html;


                }
            }
        }


        var visit = localStorage.getItem('visit');      //creperinregisterにvisitをsessionStorageに保存されている。それの呼び出し。
        console.log(visit);
        var badgescore = localStorage.getItem('badgescore');        //スコアによってバッジの色変
        var rank = localStorage.getItem('rank');    //rankによってバッジの色変
        var answerrate = localStorage.getItem('answerrate');

        window.onload = async function () {     //トップページ読み込み時処理
            var sql = `SELECT * FROM Chat order by time desc limit 10; `;
            var objects = await osql.connect(sql);
            console.log(objects);
            var html = '';
            html = html + '<table border="1">';
            html = html + '<tr>';
            html = html + '<th>' + 'ユーザー名' + '</th>';
            html = html + '<th>' + 'ツイート' + '</th>';
            html = html + '<th>' + '時間' + '</th>';
            html = html + '</tr>';
            for (var i = 0; i < objects.length; i++) {
                html = html + '<tr>';
                var object = objects[i];
                html = html + '<td>' + object.username + '</td>';
                html = html + '<td>' + object.tweet + '</td>';
                html = html + '<td>' + object.time + '</td>';
                html = html + '</tr>';
            }
            html = html + '</table>';
            document.getElementById('chat').innerHTML = html;




            //バッジの処理

            if (visit >= 10) {
                document.getElementById('btn1').click();        //上のif条件達成時に下に書いたボタンを押す
            }
            if (visit >= 30) {
                document.getElementById('btn2').click();
            }
            if (visit >= 50) {
                document.getElementById('btn3').click();
            }


            if (visit >= 4) {        //1回15分だから4回で1時間。今は1回15秒。
                document.getElementById('btn4').click();
            }
            if (visit >= 12) {
                document.getElementById('btn5').click();
            }
            if (visit >= 20) {
                document.getElementById('btn6').click();
            }
            if (visit >= 40) {
                document.getElementById('btn7').click();
            }

            if (badgescore >= 5) {          //今はスコア5行ったらにしてる。本当は500
                document.getElementById('btn8').click();
            }
            if (badgescore >= 7) {
                document.getElementById('btn9').click();
            }
            if (badgescore >= 10) {
                document.getElementById('btn10').click();
            }

            if (rank >= 10) {
                document.getElementById('btn11').click();
            }
            if (rank >= 30) {
                document.getElementById('btn12').click();
            }
            if (rank >= 50) {
                document.getElementById('btn13').click();
            }

            if (answerrate >= 90) {
                document.getElementById('btn14').click();
            }
            if (answerrate >= 95) {
                document.getElementById('btn15').click();
            }
            if (answerrate >= 100) {
                document.getElementById('btn16').click();
            }
        }



        document.addEventListener("DOMContentLoaded", function () {     //ボタンを押したら色変える
            document.getElementById('btn1').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn2').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn3').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn4').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn5').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn6').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn7').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn8').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn9').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn10').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn11').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn12').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn13').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn14').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn15').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
            document.getElementById('btn16').addEventListener('click',
                function () {
                    this.style.backgroundColor = "red";
                }
            )
        })



    </script>

</head>

<h1>トップページ</h1>
<p id="welcome"></p>
<a href="creperintest.html">クレペリン検査はこちら</a>
<br>
<div class="left" style="float: left;">
    <h2>ランク</h2>
    <p id="rank"></p>
    <h2>バッジ</h2>
    <!-- <p id="badge"></p> -->
    <button id="btn1" style="width: 90px; height: 90px;">ゲームを10回した</button>
    <button id="btn2" style="width: 90px; height: 90px;">ゲームを30回した</button>
    <button id="btn3" style="width: 90px; height: 90px;">ゲームを50回した</button>
    <button id="btn4" style="width: 90px; height: 90px;">ゲームを1時間した</button>
    <br>
    <button id="btn5" style="width: 90px; height: 90px;">ゲームを3時間した</button>
    <button id="btn6" style="width: 90px; height: 90px;">ゲームを5時間した</button>
    <button id="btn7" style="width: 90px; height: 90px;">ゲームを10時間した</button>
    <button id="btn8" style="width: 90px; height: 90px;">スコア500突破</button>
    <br>
    <button id="btn9" style="width: 90px; height: 90px;">スコア550突破</button>
    <button id="btn10" style="width: 90px; height: 90px;">スコア600突破</button>
    <button id="btn11" style="width: 90px; height: 90px;">ランク10突破</button>
    <button id="btn12" style="width: 90px; height: 90px;">ランク30突破</button>
    <br>
    <button id="btn13" style="width: 90px; height: 90px;">ランク50突破</button>
    <button id="btn14" style="width: 90px; height: 90px;">正解率90%超えた</button>
    <button id="btn15" style="width: 90px; height: 90px;">正解率95%超えた</button>
    <button id="btn16" style="width: 90px; height: 90px;">正解率100%達成</button>

</div>
<div class="right" style="float: right; padding-right: 100px; padding-left: 100px;">
    <h2>チャット</h2>
    <input type="text" id="content">
    <button onclick="tweet()">つぶやく</button>
    <p id="chat"></p>
</div>

<!-- <button onclick="a()">a</button>
<button onclick="b()">b</button> -->

</body>

</html>